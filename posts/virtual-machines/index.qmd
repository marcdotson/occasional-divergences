---
title: "Spinning up and using virtual machines for R and Python"
author: "Marc Dotson"
date: "2025-06-16"
description: |
  Breaking through computational bottlenecks can be challenging, but spinning up and using a virtual machine comes with its own set of problems. This post walks through the process of spinning up and using virtual machines for R and Python.
categories:
  - positron
  - r
  - python
image: figures/owl.png
slug: virtual-machines
---

It's not uncommon to run into computational bottlenecks when running models, Bayesian or otherwise. I've often had access to a dedicated computer or server for such tasks or, in classic academic fashion, I've been comfortable with letting models run for weeks. But these options aren't always available and they might not actually solve the problem. Cloud computing is clearly the solution. However, breaking into cloud computing has made me feel the need to (with apologies) adapt the adage often applied to using regular expressions: "If you have a problem that requires cloud computing, congratulations, you now have two problems."

There are a number of cloud service providers, AWS arguably chief among them. However, since AWS can do *everything*, it can be a struggle when what I really need is the ability to quickly spin up and temporarily use a virtual machine that can easily run R, Python, and often Stan. One of the primary reasons I've seen VS Code be so hyped is the use of its SSH extension for easily tunneling into and using such a virtual machine. However, the virtual machine needs to be spun up in the first place. In short, using cloud computing definitely feels like a *how to draw an owl* situation.

![](figures/owl.png){width=50% fig-align="center"}

In this post, I try to fill in the gaps and provide a gentle introduction to spinning up and using virtual machines that can run R and Python. I'll be using [Positron](https://positron.posit.co), a next-generation data science IDE that is a fork of VS Code's open source core. For a brief introduction to Positron, check out [this post](https://occasionaldivergences.com/posts/positron-intro/). Special thanks to Sharad Jones, Lizzy Nguyen, and Andrew Heiss for helping me navigate all of this.

## Spinning up virtual machines

A virtual machine (VM) is a computer that isn't *actually* a computer---it's rented time on a server in a data center somewhere, hence it being "virtual." But before we can set (or spin) up a VM, we need to prepare the machine image we want to work with on the VM. This image is really a [reproducible environment](https://occasionaldivergences.com/posts/rep-env/) writ large: It needs to include not only the required programming languages and packages, but also the operating system and necesssary applications.

::: {.callout-note title="Image Requirements?"}
Do we actually need to specify the operating system and applications for an image? If I SSH into a machine from an IDE, shouldn't that IDE be all that I need, regardless of whatever is installed at the other end? To that end, do I really even need Docker at that point?

I'm loooking for the simplest possible way to get computation started, and certainly having to create an image is just another bottleneck.

You can think of an image as a *snapshot* of everything you need to run your model. That means once you have an image, it can be used to run models isolated from everything else. These self-contained images are known as *containers*. Designed for development and production well beyond the scope of what we're discussing, the fact that they have everything they need to run in isolation means you can have multiple containers running on your computer, actual or virtual.

There are a number of applications for creating images and "containerizing" them, Docker arguably chief among them. But, to adapt Jenny Bryan's adage about for loops: "Someone needs to build an image, but it doesn't have to be you." There are a plethora of pre-built images available on Docker Hub. It's like GitHub, but specifically for images.
:::

Sharad's AWS/EC2 setup walkthrough:

- EC2 (Easy Compute Cloud) launch instance
- Name it, selected AMI (Amazon Machine Image): Ubuntu (not a WSL Linux image for Positron) plus image specifics (needs Ubuntu 22+ for Positron). "Older Linux distributions and arm64 hosts aren’t currently supported."

> Yes, I believe Python 3.12 is included with that AMI: https://discourse.ubuntu.com/t/ubuntu-24-04-lts-noble-numbat-release-notes/39890#p-99950-toolchain-upgrades

What AMI doesn't include Python? And will it automatically switch to the right environment and version?

- Note free tier options, which architecture to select (x86 only).
- Instance type appropriate for my work? Note free tiers.
- The first time, create a new key pair for SSH connection using RSA and .pem for OpenSSH. (Best to have it live in `~/.ssh/` on your computer, if you have a Mac.)
- Create or use an existing security group and allow SSH traffic. Maybe from My IP.
- Configure storage is for the EBS volume. Doesn't need to be tied to the EC2 instance, can be kept for later use? They run separately.
- Port 22 is specific for inbound traffic using SSH.

SSH into the instance using the key pair:

- In Positron, use the Remote Explorer.
- Use the Host alias for the server details specified in the Config file:

```
Host test-server
    HostName <IP address>
    User ubuntu
    PubKeyAuthentication yes
    IdentityFile ~/.ssh/keypair.pem
```

> I also want to call out that installing uv after opening Positron may result in some strange behavior; Positron checks whether uv is installed right when it opens, and caches the result. So that's why a restart sometimes helps.

- Connect. Bottom left indicates SSH connection.
- Positron installed automatically.
- Install uv with `curl -LsSf https://astral.sh/uv/install.sh | sh` (since its Linux) and restart the terminal with `exec bash`.
- Move project details using GitHub over and then `uv run` to get everything setup?! USE GITHUB??????
- Need at least t2.medium, which has more memory and CPU power.

Additional notes:

- Am I missing usu-asc login?!
- EBS volume on Amazon for external connection
- AMI as a launch script instead of a Docker image?
- S3 to transfer quickly to EBS volumes on EC2
- Script for spinning up a machine from local IDE? Just use GitHub?

### 1. Create/modify an image using Docker Compose?

This isn't a tutorial for creating a Docker image. In the short term, I need a VS Code image that's ready to run Python (bonus for R and Stan). In the long term, once SSH tunneling is a thing in Positron, I'll want to modify my own template, include it as a repo on GitHub, and have it connected to Docker Hub.

- Here's one for just R and VS Code: https://github.com/RamiKrispin/vscode-r

> He's got Dockerfiles in the different example folders (github.com/RamiKrispin/...) and you build them yourself (right click on the Dockerfile in VS Code and choose Build Image…)
> 
> I set up docker on the remote computer and then build the Docker container on the remote computer using an SSH-connected VS Code window

- Here's an example from Andrew using R, Python, and Quarto: https://github.com/andrewheiss/example-r-python-quarto-docker
- Andrew's old blog post: https://www.andrewheiss.com/blog/2017/04/27/super-basic-practical-guide-to-docker-and-rstudio/index.html

### 2. Use the image as a container when spinning up the VM?

> As far as we know, no one's made a Docker + R + Python + Positron. But you don't really need Positron in the image, just R and Python -- Positron downloads its server component into the remote host as part of establishing a session. -Jonathan @ Posit

- Spin up the container using Docker. Official Digital Ocean documentation to link?
- Log in using the Droplet's public IPv4 address: `$ ssh root@__.___.__.___`
- Pull the Docker image you want to use `$ docker pull rocker/tidyverse`
- Run the image at a specific port `$ docker run -d -p 8787:8787 rocker/tidyverse`
- Access the remote installation at `__.___.__.___:8787`

::: {.callout-note title="AWS is Too General?"}
I feel like this is similar to the complaints I make about VS Code. Add some guidelines on how to do this in AWS to the callout note?

AWS, like Azure and GCP (is it too general)? Can use AWS for *anything*. App hosting, etc. Including using GPU clusters and quantum computing! Cutting a cake with a chainsaw.

- Andrew Brown's AWS Certified Cloud Practitioner Certification Course: https://www.youtube.com/watch?v=SOTamWNgDKc&list=PLWKjhJtqVAbkzvvpY12KkfiIGso9A_Ixs&index=2
- Elastic Compute Cloud (EC2) for VM or Elastic Constainer Service (ECS) for an EC2 instance with Docker installed.
- What about higher performance computing services (HPC)? Does it only come in clusters? Would I need to use CloudShell?
- S3/RDS for storage.
- Have to pick an OS, instance type, add storage...Docker?
- Memory optimized VMs have large data sets in memory.

Digital Ocean? From Andrew:

- Look for a free tier or (initial credit)[https://cloud.digitalocean.com/registrations/new?refcode=f6fcd01aaffb].
- Like AWS, you'll have a team (root user) and members in that team, which will be your way to access and use the service.
:::

## Using virtual machines

### 1. SSH tunnel in to use the container?

When we connect using Open Remote SSH, Positron Server is automatically installed. Depending on the machine image selected, there is likely already a version of Python installed as well. However, there is a need, given the likely Linux image, to install R and Python via rig and pyenv, along with some version of a virtual environment (in a project directory) and the needed packages before we can attach a volume and start to actually do any work.

- If I can't provide an image, can I provide the script needed to get the machine set up? This is technically a bash script, but without the super computing machine limitations we were facing previously.
- Or is this where an image would actually be useful and not needleslly complicated?

Now with the "Remote Explorer" icon on the left along with the bottom-left corner connection. (Not just an Open SSH thing.)

- SSH Tunneling with VS Code: https://www.youtube.com/watch?v=cOopQQIL8JU

SSH tunneling is available experimentally in Positron: https://github.com/posit-dev/positron/pull/4251 using a "lightly modified" version of Open Remote SSH (https://github.com/jeanp413/open-remote-ssh) that's already bundled into the install.

> When credentials are supplied to a remote host, Positron will connect to the host, download a server binary from Positron's Github Releases page matching the version of Positron being used on the client side, unpack the server into ~/.positron-server, then start it inside the remote host.
> 
> Because this change is experimental, the UI for connecting to remote hosts (in the lower left corner) continues to be disabled by default. To show the UI, turn on this option: "Positron: Remote Host Experimental" to "Enable support for connecting to remote hosts over SSH."
>
> Only Linux hosts on 64-bit Intel (x86_64) CPU architectures are supported right now.

May also need to install a supported SSH client: https://code.visualstudio.com/docs/remote/troubleshooting#_installing-a-supported-ssh-client. It comes built-in for macOS.

- Bottom left corner shows connection.
- Open SSH Configuration File:

Host my-server
    HostName your.server.ip.address
    User root

- 

### 2. How do I get data into and out of the container?

- What about getting an S3 instance? Is that what the EBS volume is for?
- Andrew likes to mount local folders to the docker container so he knows where everything rather than use official dev envirnoment tools that have more opaque file systems. That said, most of his work is for testing things for package development, not for computational resources.
- Note on scaling up the size of the VM.

## Final thoughts

- Consider using extensions for managing VMs inside Positron?

